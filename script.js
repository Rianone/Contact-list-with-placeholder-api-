const modal_up=document.getElementById("modal-update"),modal_add=document.getElementById("modal-add"),close=document.getElementById("cross"),add=document.getElementById("add-primary"),del=document.getElementById("delete-primary");var contacts_list,search_bar=document.getElementById("search"),nam=document.getElementById("name1"),number=document.getElementById("number1"),name_up=document.getElementById("name2"),number_up=document.getElementById("number2"),up_btn=document.getElementById("update-btn");function verif(e,t){regName=/^[a-zA-Z]{1}[a-zA-Z√©√® 1-9]{2,}$/,regNumber=/^[0-9+ ]{6,20}$/;var n=document.querySelectorAll("#invalid"),a=!0;return regName.test(e.value)?(n[0].style.display="none",n[1].style.display="none"):(a=!1,n[0].style.display="block",n[1].style.display="block"),regNumber.test(t.value)?(n[0].style.display="none",n[1].style.display="none"):(a=!1,n[0].style.display="block",n[1].style.display="block"),a}function generateId(){return Math.floor(1e3*Math.random())}function createContact(e){var t=e.name,n=e.phone,a="",l="",o="",d=null,c=document.querySelectorAll("li");for(let e=0;e<c.length;e++){const r=c[e];var s=r.firstChild;l=r.childNodes[1].firstChild.nodeValue,a=s.nodeValue,t.toUpperCase()==a.toUpperCase()&&n==l&&(o="Contact already exists",d=!0)}if(""==o){d=!1;var r,i=t[0];i=i.toUpperCase();var u=document.getElementById("contacts");u=u.childNodes;for(let e=0;e<u.length;e++)u[e].id==i&&(r=u[e]);var p=document.createElement("li"),m=document.createElement("p"),h=document.createElement("button"),y=document.createElement("button");p.innerHTML=t,m.innerHTML=n,h.innerHTML="Delete",h.className="button",h.style.transition="all 0.7s",y.innerHTML="Update",y.className="button",h.addEventListener("click",(function(){p.parentNode.removeChild(p),fetch("https://jsonplaceholder.typicode.com/users/"+e.id,{method:"DELETE"});var t=JSON.parse(localStorage.getItem("contacts")),n=[];t.forEach((t=>{e.id==t.id||n.push(t)})),alert("Contact deleted with success  üëç"),localStorage.setItem("contacts",JSON.stringify(n))})),y.addEventListener("click",(function(){modal_up.style.display="flex",up_btn.addEventListener("click",(()=>{if(verif(name_up,number_up)){modal_up.style.display="none",fetch("https://jsonplaceholder.typicode.com/users",{method:"POST",body:JSON.stringify({name:name_up.value,phone:number_up.value,id:generateId()}),headers:{"Content-type":"application/json; charset=UTF-8"}});var t,n=JSON.parse(localStorage.getItem("contacts")),a=[];n.forEach((t=>{e.id==t.id||a.push(t)})),t={id:generateId(),name:name_up.value,phone:number_up.value},a.push(t),p.style.display="none",alert("Contact updated with success  üëç"),createContact(t),localStorage.setItem("contacts",JSON.stringify(a))}}))})),r.appendChild(p),p.appendChild(m),m.appendChild(h),m.appendChild(y)}else alert(o);return d}close.addEventListener("click",(function(){modal_up.style.display="none"})),window.addEventListener("click",(function(e){e.target==modal_up&&(modal_up.style.display="none")})),search_bar.addEventListener("input",(function(){modal_add.style.display="none",modal_up.style.display="none";var e=document.querySelectorAll("h2"),t=document.querySelectorAll("li"),n=document.querySelectorAll("div");input=search_bar.value.toUpperCase();for(let t=0;t<e.length;t++)e[t].style.display="none";for(let e=0;e<n.length;e++)n[e].style.borderBottom="none";for(var a=0,l=t.length;a<l;a++)contact=t[a].innerHTML.toUpperCase(),contact.indexOf(input)>-1?t[a].style.display="block":t[a].style.display="none"})),search_bar.addEventListener("blur",(function(){var e=document.querySelectorAll("h2"),t=document.querySelectorAll("div");for(let t=0;t<e.length;t++)e[t].style.display="block";for(let e=0;e<t.length;e++)t[e].style.borderBottom="3px blue solid"})),localStorage.getItem("contacts")?(contacts_list=localStorage.getItem("contacts"),(contacts_list=JSON.parse(contacts_list)).forEach((e=>{var t=e.name,n=e.phone,a="",l="",o="",d=document.querySelectorAll("li");for(let e=0;e<d.length;e++){const s=d[e];var c=s.firstChild;l=s.childNodes[1].firstChild.nodeValue,a=c.nodeValue,t.toUpperCase()==a.toUpperCase()&&n==l&&(o="Contact already exists")}if(""==o){var s,r=t[0];r=r.toUpperCase();var i=document.getElementById("contacts");i=i.childNodes;for(let e=0;e<i.length;e++)i[e].id==r&&(s=i[e]);var u=document.createElement("li"),p=document.createElement("p"),m=document.createElement("button"),h=document.createElement("button");u.innerHTML=t,p.innerHTML=n,m.innerHTML="Delete",m.className="button",m.style.transition="all 0.7s",h.innerHTML="Update",h.className="button",m.addEventListener("click",(function(){u.parentNode.removeChild(u);var t=[];contacts_list.forEach((n=>{e.id==n.id||t.push(n)})),alert("Contact deleted with success  üëç"),localStorage.setItem("contacts",JSON.stringify(t))})),h.addEventListener("click",(function(){modal_up.style.display="flex",up_btn.addEventListener("click",(()=>{var t=contacts_list,n=[],a=null;verif(name_up,number_up)&&(modal_up.style.display="none",t.forEach((t=>{e.id==t.id||n.push(t)})),a={id:generateId(),name:name_up.value,phone:number_up.value},n.push(a),u.style.display="none",alert("Contact updated with success  üëç"),createContact(a),localStorage.setItem("contacts",JSON.stringify(n)))}))})),s.appendChild(u),u.appendChild(p),p.appendChild(m),p.appendChild(h)}else alert(o)}))):fetch("https://jsonplaceholder.typicode.com/users").then((e=>e.json())).then((e=>{console.log(e),contacts_list=e})).then((()=>{var e=[];contacts_list.forEach((t=>{var n=t.name,a=t.phone,l="",o="",d="",c=document.querySelectorAll("li");for(let e=0;e<c.length;e++){const t=c[e];var s=t.firstChild;o=t.childNodes[1].firstChild.nodeValue,l=s.nodeValue,n.toUpperCase()==l.toUpperCase()&&a==o&&(d="Contact already exists")}if(""==d){var r,i=n[0];i=i.toUpperCase();var u=document.getElementById("contacts");u=u.childNodes;for(let e=0;e<u.length;e++)u[e].id==i&&(r=u[e]);var p=document.createElement("li"),m=document.createElement("p"),h=document.createElement("button"),y=document.createElement("button");p.innerHTML=n,m.innerHTML=a,h.innerHTML="Delete",h.className="button",h.style.transition="all 0.7s",y.innerHTML="Update",y.className="button",e.push({id:generateId(),name:n,phone:a}),h.addEventListener("click",(function(){p.parentNode.removeChild(p),fetch("https://jsonplaceholder.typicode.com/users/"+t.id,{method:"DELETE"});var e=[];contacts_list.forEach((n=>{t.id==n.id||e.push(n)})),alert("Contact deleted with success  üëç"),localStorage.setItem("contacts",JSON.stringify(e))})),y.addEventListener("click",(function(){modal_up.style.display="flex",up_btn.addEventListener("click",(()=>{if(verif(name_up,number_up)){modal_up.style.display="none",fetch("https://jsonplaceholder.typicode.com/users",{method:"POST",body:JSON.stringify({name:name_up.value,phone:number_up.value,id:generateId()}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((e=>e.json()));var e,n=contacts_list,a=[];modal_up.style.display="none",n.forEach((e=>{t.id==e.id||a.push(e)})),e={id:generateId(),name:name_up.value,phone:number_up.value},a.push(e),p.style.display="none",alert("Contact updated with success  üëç"),createContact(e),localStorage.setItem("contacts",JSON.stringify(a))}}))})),r.appendChild(p),p.appendChild(m),m.appendChild(h),m.appendChild(y)}else alert(d)})),localStorage.setItem("contacts",JSON.stringify(e))})),del.addEventListener("click",(function(){if(confirm("Are you sure you want to delete all contacts ?")){var e=document.querySelectorAll("li");for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);modal_add.style.display="none"}localStorage.setItem("contacts"," ")})),add.addEventListener("click",(function(){modal_add.style.display="flex",document.getElementById("add-btn").addEventListener("click",(function(){if(verif(nam,number)){var e=nam.value,t=number.value;nam.value="",number.value="",modal_add.style.display="none",fetch("https://jsonplaceholder.typicode.com/users",{method:"POST",body:JSON.stringify({name:e,phone:t,id:generateId()}),headers:{"Content-type":"application/json; charset=UTF-8"}})}var n=JSON.parse(localStorage.getItem("contacts")),a={id:generateId(),name:e,phone:t};n.push(a),alert("Contact updated with success  üëç"),createContact(a),localStorage.setItem("contacts",JSON.stringify(n))}))}));